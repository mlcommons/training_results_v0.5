STARTING TIMING RUN AT 2018-11-15 01:54:31 PM
parallelism=28, random seed=1542318871, learning rate=0.003821, batch size=98304, beta1=0.783529, beta2=0.909003, max epoch=20, eps=1.45439E-07
unzip ml-20m.zip
Archive:  ml-20m.zip
  inflating: ml-20m/genome-scores.csv  
  inflating: ml-20m/genome-tags.csv  
  inflating: ml-20m/links.csv        
  inflating: ml-20m/movies.csv       
  inflating: ml-20m/ratings.csv      
  inflating: ml-20m/README.txt       
  inflating: ml-20m/tags.csv         
Start training
:::MLPv0.5.0 ncf 1542318878.708 (NeuralCFexample.scala:70) run_start
:::MLPv0.5.0 ncf 1542318878.713 (NeuralCFexample.scala:71) run_clear_caches
:::MLPv0.5.0 ncf 1542318878.742 (NeuralCFexample.scala:133) seed: 1542318871
2018-11-15 13:54:38 INFO  Engine$:107 - Detect bigdl.localMode is set. Run workload without spark
2018-11-15 13:54:38 INFO  ThreadPool$:86 - Set mkl threads to 1 on thread 1
:::MLPv0.5.0 ncf 1542318878.957 (NeuralCFexample.scala:138) opt_learning_rate: 0.003821
:::MLPv0.5.0 ncf 1542318878.957 (NeuralCFexample.scala:139) create_optim_method: {"name": "Adam", "lr": 0.003821, "beta1": 0.783529, "beta2": 0.909003, "eps": 1.45439E-7}
2018-11-15 13:54:38 INFO  EmbeddingAdam2$:335 - init power start
2018-11-15 13:54:39 INFO  EmbeddingAdam2$:342 - init power done
:::MLPv0.5.0 ncf 1542318918.452 (NeuralCFexample.scala:170) preproc_hp_num_eval: 999
:::MLPv0.5.0 ncf 1542318918.453 (NeuralCFexample.scala:171) preproc_hp_sample_eval_replacement
:::MLPv0.5.0 ncf 1542318921.304 (GenerateData.scala:187) preproc_hp_min_ratings: 20
2018-11-15 13:55:21 INFO  GenerateData$:216 - Compared with pytorch's test-ratings.csv, eval positive is different 18048 of 138493, so we use pytorch's test-rating.csv to stay the same with pytorch's test positive.
:::MLPv0.5.0 ncf 1542318921.613 (GenerateData.scala:219) input_hp_sample_train_replacement
:::MLPv0.5.0 ncf 1542318922.401 (GenerateData.scala:227) input_step_eval_neg_gen
:::MLPv0.5.0 ncf 1542318935.093 (NeuralCFexample.scala:186) model_hp_mf_dim: 64
:::MLPv0.5.0 ncf 1542318935.093 (NeuralCFexample.scala:187) model_hp_mlp_layer_sizes: "[256, 256, 128, 64]"
:::MLPv0.5.0 ncf 1542318940.802 (NeuralCFexample.scala:199) model_hp_loss_fn: "binary_cross_entropy"
2018-11-15 13:55:40 INFO  NCFOptimizer2$:384 - Clone 1 model...
2018-11-15 13:55:40 INFO  NCFOptimizer2$:384 - Clone 2 model...
2018-11-15 13:55:40 INFO  NCFOptimizer2$:384 - Clone 3 model...
2018-11-15 13:55:40 INFO  NCFOptimizer2$:384 - Clone 4 model...
2018-11-15 13:55:40 INFO  NCFOptimizer2$:384 - Clone 5 model...
2018-11-15 13:55:40 INFO  NCFOptimizer2$:384 - Clone 6 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 7 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 8 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 9 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 10 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 11 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 12 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 13 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 14 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 15 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 16 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 17 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 18 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 19 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 20 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 21 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 22 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 23 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 24 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 25 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 26 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 27 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 28 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 1 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 2 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 3 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 4 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 5 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 6 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 7 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 8 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 9 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 10 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 11 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 12 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 13 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 14 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 15 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 16 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 17 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 18 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 19 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 20 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 21 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 22 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 23 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 24 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 25 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 26 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 27 model...
2018-11-15 13:55:41 INFO  NCFOptimizer2$:384 - Clone 28 model...
:::MLPv0.5.0 ncf 1542318941.184 (NCFOptimizer2.scala:105) train_loop
:::MLPv0.5.0 ncf 1542318941.336 (NCFDataSet.scala:38) input_hp_num_neg: 4
2018-11-15 13:55:43 INFO  NCFOptimizer2$:117 - Generate epoch 1 data: 1863 ms
2018-11-15 13:55:43 INFO  NCFOptimizer2$:120 - model thread pool size is 1
:::MLPv0.5.0 ncf 1542318943.375 (NCFOptimizer2.scala:125) train_epoch: 0
2018-11-15 13:58:52 INFO  NCFOptimizer2$:251 - [Epoch 1 99385344/99385344][Iteration 1012][Wall Clock 189.359648925s] loss is 0.12794743637953485, training cost 189.359648925s. Throughput is 524849.6422770815 record / second. 
:::MLPv0.5.0 ncf 1542319132.822 (NCFOptimizer2.scala:312) eval_start: 0
2018-11-15 13:58:52 INFO  NCFOptimizer2$:313 - [Epoch 1 99385344/99385344][Iteration 1012][Wall Clock 189.359648925s] Validate model...
2018-11-15 13:59:43 INFO  NCFOptimizer2$:358 - [Epoch 1 99385344/99385344][Iteration 1012][Wall Clock 189.359648925s] HitRatio@10 is (HitRatio@10: 74661.0, count: 138493, Average HitRatio@10: 0.5390958)
:::MLPv0.5.0 ncf 1542319183.081 (NCFOptimizer2.scala:359) eval_size: {"epoch": 0, "value": 138493000}
:::MLPv0.5.0 ncf 1542319183.081 (NCFOptimizer2.scala:361) eval_hp_num_users: 138493
:::MLPv0.5.0 ncf 1542319183.081 (NCFOptimizer2.scala:362) eval_hp_num_neg: 999
:::MLPv0.5.0 ncf 1542319183.082 (NCFOptimizer2.scala:363) eval_accuracy: {"epoch": 0, "value": 0.5390958}
2018-11-15 13:59:43 INFO  NCFOptimizer2$:368 - [Epoch 1 99385344/99385344][Iteration 1012][Wall Clock 189.359648925s] Validation time cost: 50.259648695s. Throughput is 2755550.4981828043 samples / sec
:::MLPv0.5.0 ncf 1542319183.082 (NCFOptimizer2.scala:370) eval_stop
:::MLPv0.5.0 ncf 1542319183.082 (NCFOptimizer2.scala:260) input_step_train_neg_gen
:::MLPv0.5.0 ncf 1542319183.082 (NCFDataSet.scala:38) input_hp_num_neg: 4
:::MLPv0.5.0 ncf 1542319184.762 (NCFOptimizer2.scala:263) train_epoch: 1
2018-11-15 13:59:44 INFO  NCFOptimizer2$:264 - Generate epoch 2 data: 1680 ms
2018-11-15 14:02:21 INFO  NCFOptimizer2$:251 - [Epoch 2 99385344/99385344][Iteration 2023][Wall Clock 346.109106773s] loss is 0.11208034413201469, training cost 156.749457848s. Throughput is 634039.4752521185 record / second. 
:::MLPv0.5.0 ncf 1542319341.575 (NCFOptimizer2.scala:312) eval_start: 1
2018-11-15 14:02:21 INFO  NCFOptimizer2$:313 - [Epoch 2 99385344/99385344][Iteration 2023][Wall Clock 346.109106773s] Validate model...
2018-11-15 14:03:11 INFO  NCFOptimizer2$:358 - [Epoch 2 99385344/99385344][Iteration 2023][Wall Clock 346.109106773s] HitRatio@10 is (HitRatio@10: 81210.0, count: 138493, Average HitRatio@10: 0.5863834)
:::MLPv0.5.0 ncf 1542319391.620 (NCFOptimizer2.scala:359) eval_size: {"epoch": 1, "value": 138493000}
:::MLPv0.5.0 ncf 1542319391.621 (NCFOptimizer2.scala:361) eval_hp_num_users: 138493
:::MLPv0.5.0 ncf 1542319391.621 (NCFOptimizer2.scala:362) eval_hp_num_neg: 999
:::MLPv0.5.0 ncf 1542319391.621 (NCFOptimizer2.scala:363) eval_accuracy: {"epoch": 1, "value": 0.5863834}
2018-11-15 14:03:11 INFO  NCFOptimizer2$:368 - [Epoch 2 99385344/99385344][Iteration 2023][Wall Clock 346.109106773s] Validation time cost: 50.045336841s. Throughput is 2767350.7411891096 samples / sec
:::MLPv0.5.0 ncf 1542319391.621 (NCFOptimizer2.scala:370) eval_stop
:::MLPv0.5.0 ncf 1542319391.622 (NCFOptimizer2.scala:260) input_step_train_neg_gen
:::MLPv0.5.0 ncf 1542319391.622 (NCFDataSet.scala:38) input_hp_num_neg: 4
:::MLPv0.5.0 ncf 1542319392.983 (NCFOptimizer2.scala:263) train_epoch: 2
2018-11-15 14:03:12 INFO  NCFOptimizer2$:264 - Generate epoch 3 data: 1363 ms
2018-11-15 14:05:50 INFO  NCFOptimizer2$:251 - [Epoch 3 99385344/99385344][Iteration 3034][Wall Clock 503.767962071s] loss is 0.10613859231982913, training cost 157.658855298s. Throughput is 630382.2504111558 record / second. 
:::MLPv0.5.0 ncf 1542319550.696 (NCFOptimizer2.scala:312) eval_start: 2
2018-11-15 14:05:50 INFO  NCFOptimizer2$:313 - [Epoch 3 99385344/99385344][Iteration 3034][Wall Clock 503.767962071s] Validate model...
2018-11-15 14:06:40 INFO  NCFOptimizer2$:358 - [Epoch 3 99385344/99385344][Iteration 3034][Wall Clock 503.767962071s] HitRatio@10 is (HitRatio@10: 84640.0, count: 138493, Average HitRatio@10: 0.61115)
:::MLPv0.5.0 ncf 1542319600.733 (NCFOptimizer2.scala:359) eval_size: {"epoch": 2, "value": 138493000}
:::MLPv0.5.0 ncf 1542319600.733 (NCFOptimizer2.scala:361) eval_hp_num_users: 138493
:::MLPv0.5.0 ncf 1542319600.733 (NCFOptimizer2.scala:362) eval_hp_num_neg: 999
:::MLPv0.5.0 ncf 1542319600.734 (NCFOptimizer2.scala:363) eval_accuracy: {"epoch": 2, "value": 0.61115}
2018-11-15 14:06:40 INFO  NCFOptimizer2$:368 - [Epoch 3 99385344/99385344][Iteration 3034][Wall Clock 503.767962071s] Validation time cost: 50.037385979s. Throughput is 2767790.4688730864 samples / sec
:::MLPv0.5.0 ncf 1542319600.734 (NCFOptimizer2.scala:370) eval_stop
:::MLPv0.5.0 ncf 1542319600.734 (NCFOptimizer2.scala:260) input_step_train_neg_gen
:::MLPv0.5.0 ncf 1542319600.734 (NCFDataSet.scala:38) input_hp_num_neg: 4
:::MLPv0.5.0 ncf 1542319602.064 (NCFOptimizer2.scala:263) train_epoch: 3
2018-11-15 14:06:42 INFO  NCFOptimizer2$:264 - Generate epoch 4 data: 1331 ms
2018-11-15 14:09:18 INFO  NCFOptimizer2$:251 - [Epoch 4 99385344/99385344][Iteration 4045][Wall Clock 660.377293959s] loss is 0.09912976383098535, training cost 156.609331888s. Throughput is 634606.7811021374 record / second. 
:::MLPv0.5.0 ncf 1542319758.728 (NCFOptimizer2.scala:312) eval_start: 3
2018-11-15 14:09:18 INFO  NCFOptimizer2$:313 - [Epoch 4 99385344/99385344][Iteration 4045][Wall Clock 660.377293959s] Validate model...
2018-11-15 14:10:08 INFO  NCFOptimizer2$:358 - [Epoch 4 99385344/99385344][Iteration 4045][Wall Clock 660.377293959s] HitRatio@10 is (HitRatio@10: 86167.0, count: 138493, Average HitRatio@10: 0.6221759)
:::MLPv0.5.0 ncf 1542319808.911 (NCFOptimizer2.scala:359) eval_size: {"epoch": 3, "value": 138493000}
:::MLPv0.5.0 ncf 1542319808.911 (NCFOptimizer2.scala:361) eval_hp_num_users: 138493
:::MLPv0.5.0 ncf 1542319808.912 (NCFOptimizer2.scala:362) eval_hp_num_neg: 999
:::MLPv0.5.0 ncf 1542319808.912 (NCFOptimizer2.scala:363) eval_accuracy: {"epoch": 3, "value": 0.6221759}
2018-11-15 14:10:08 INFO  NCFOptimizer2$:368 - [Epoch 4 99385344/99385344][Iteration 4045][Wall Clock 660.377293959s] Validation time cost: 50.18418929s. Throughput is 2759693.8788766474 samples / sec
:::MLPv0.5.0 ncf 1542319808.913 (NCFOptimizer2.scala:370) eval_stop
:::MLPv0.5.0 ncf 1542319808.913 (NCFOptimizer2.scala:260) input_step_train_neg_gen
:::MLPv0.5.0 ncf 1542319808.913 (NCFDataSet.scala:38) input_hp_num_neg: 4
:::MLPv0.5.0 ncf 1542319810.242 (NCFOptimizer2.scala:263) train_epoch: 4
2018-11-15 14:10:10 INFO  NCFOptimizer2$:264 - Generate epoch 5 data: 1330 ms
2018-11-15 14:12:47 INFO  NCFOptimizer2$:251 - [Epoch 5 99385344/99385344][Iteration 5056][Wall Clock 817.349969621s] loss is 0.09521089866757393, training cost 156.972675662s. Throughput is 633137.86033692 record / second. 
:::MLPv0.5.0 ncf 1542319967.269 (NCFOptimizer2.scala:312) eval_start: 4
2018-11-15 14:12:47 INFO  NCFOptimizer2$:313 - [Epoch 5 99385344/99385344][Iteration 5056][Wall Clock 817.349969621s] Validate model...
2018-11-15 14:13:37 INFO  NCFOptimizer2$:358 - [Epoch 5 99385344/99385344][Iteration 5056][Wall Clock 817.349969621s] HitRatio@10 is (HitRatio@10: 86897.0, count: 138493, Average HitRatio@10: 0.6274469)
:::MLPv0.5.0 ncf 1542320017.358 (NCFOptimizer2.scala:359) eval_size: {"epoch": 4, "value": 138493000}
:::MLPv0.5.0 ncf 1542320017.358 (NCFOptimizer2.scala:361) eval_hp_num_users: 138493
:::MLPv0.5.0 ncf 1542320017.358 (NCFOptimizer2.scala:362) eval_hp_num_neg: 999
:::MLPv0.5.0 ncf 1542320017.358 (NCFOptimizer2.scala:363) eval_accuracy: {"epoch": 4, "value": 0.6274469}
2018-11-15 14:13:37 INFO  NCFOptimizer2$:368 - [Epoch 5 99385344/99385344][Iteration 5056][Wall Clock 817.349969621s] Validation time cost: 50.08902433s. Throughput is 2764937.0666030697 samples / sec
:::MLPv0.5.0 ncf 1542320017.358 (NCFOptimizer2.scala:370) eval_stop
:::MLPv0.5.0 ncf 1542320017.359 (NCFOptimizer2.scala:260) input_step_train_neg_gen
:::MLPv0.5.0 ncf 1542320017.359 (NCFDataSet.scala:38) input_hp_num_neg: 4
:::MLPv0.5.0 ncf 1542320018.608 (NCFOptimizer2.scala:263) train_epoch: 5
2018-11-15 14:13:38 INFO  NCFOptimizer2$:264 - Generate epoch 6 data: 1249 ms
2018-11-15 14:16:14 INFO  NCFOptimizer2$:251 - [Epoch 6 99385344/99385344][Iteration 6067][Wall Clock 973.51602569s] loss is 0.09272200667432376, training cost 156.166056069s. Throughput is 636408.1062282051 record / second. 
:::MLPv0.5.0 ncf 1542320174.827 (NCFOptimizer2.scala:312) eval_start: 5
2018-11-15 14:16:14 INFO  NCFOptimizer2$:313 - [Epoch 6 99385344/99385344][Iteration 6067][Wall Clock 973.51602569s] Validate model...
2018-11-15 14:17:04 INFO  NCFOptimizer2$:358 - [Epoch 6 99385344/99385344][Iteration 6067][Wall Clock 973.51602569s] HitRatio@10 is (HitRatio@10: 88317.0, count: 138493, Average HitRatio@10: 0.6377001)
:::MLPv0.5.0 ncf 1542320224.966 (NCFOptimizer2.scala:359) eval_size: {"epoch": 5, "value": 138493000}
:::MLPv0.5.0 ncf 1542320224.967 (NCFOptimizer2.scala:361) eval_hp_num_users: 138493
:::MLPv0.5.0 ncf 1542320224.967 (NCFOptimizer2.scala:362) eval_hp_num_neg: 999
:::MLPv0.5.0 ncf 1542320224.967 (NCFOptimizer2.scala:363) eval_accuracy: {"epoch": 5, "value": 0.6377001}
2018-11-15 14:17:04 INFO  NCFOptimizer2$:368 - [Epoch 6 99385344/99385344][Iteration 6067][Wall Clock 973.51602569s] Validation time cost: 50.13941945s. Throughput is 2762158.028935854 samples / sec
:::MLPv0.5.0 ncf 1542320224.967 (NCFOptimizer2.scala:370) eval_stop
:::MLPv0.5.0 ncf 1542320224.967 (NeuralCFexample.scala:507) eval_target: 0.635
:::MLPv0.5.0 ncf 1542320224.968 (NeuralCFexample.scala:509) run_stop: {"success": true}
:::MLPv0.5.0 ncf 1542320225.007 (NeuralCFexample.scala:234) run_final
Finish training in 1349 seconds
ENDING TIMING RUN AT 2018-11-15 02:17:05 PM
RESULT,recommendation,1542318871,1354,rpremsee,2018-11-15 01:54:31 PM
