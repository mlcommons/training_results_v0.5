STARTING TIMING RUN AT 2018-11-15 03:30:00 PM
parallelism=28, random seed=1542324600, learning rate=0.003821, batch size=98304, beta1=0.783529, beta2=0.909003, max epoch=20, eps=1.45439E-07
unzip ml-20m.zip
Archive:  ml-20m.zip
  inflating: ml-20m/genome-scores.csv  
  inflating: ml-20m/genome-tags.csv  
  inflating: ml-20m/links.csv        
  inflating: ml-20m/movies.csv       
  inflating: ml-20m/ratings.csv      
  inflating: ml-20m/README.txt       
  inflating: ml-20m/tags.csv         
Start training
:::MLPv0.5.0 ncf 1542324610.812 (NeuralCFexample.scala:70) run_start
:::MLPv0.5.0 ncf 1542324610.816 (NeuralCFexample.scala:71) run_clear_caches
:::MLPv0.5.0 ncf 1542324610.846 (NeuralCFexample.scala:133) seed: 1542324600
2018-11-15 15:30:10 INFO  Engine$:107 - Detect bigdl.localMode is set. Run workload without spark
2018-11-15 15:30:11 INFO  ThreadPool$:86 - Set mkl threads to 1 on thread 1
:::MLPv0.5.0 ncf 1542324611.062 (NeuralCFexample.scala:138) opt_learning_rate: 0.003821
:::MLPv0.5.0 ncf 1542324611.063 (NeuralCFexample.scala:139) create_optim_method: {"name": "Adam", "lr": 0.003821, "beta1": 0.783529, "beta2": 0.909003, "eps": 1.45439E-7}
2018-11-15 15:30:11 INFO  EmbeddingAdam2$:335 - init power start
2018-11-15 15:30:11 INFO  EmbeddingAdam2$:342 - init power done
:::MLPv0.5.0 ncf 1542324648.626 (NeuralCFexample.scala:170) preproc_hp_num_eval: 999
:::MLPv0.5.0 ncf 1542324648.626 (NeuralCFexample.scala:171) preproc_hp_sample_eval_replacement
:::MLPv0.5.0 ncf 1542324651.119 (GenerateData.scala:187) preproc_hp_min_ratings: 20
2018-11-15 15:30:51 INFO  GenerateData$:216 - Compared with pytorch's test-ratings.csv, eval positive is different 18048 of 138493, so we use pytorch's test-rating.csv to stay the same with pytorch's test positive.
:::MLPv0.5.0 ncf 1542324651.375 (GenerateData.scala:219) input_hp_sample_train_replacement
:::MLPv0.5.0 ncf 1542324652.507 (GenerateData.scala:227) input_step_eval_neg_gen
:::MLPv0.5.0 ncf 1542324664.943 (NeuralCFexample.scala:186) model_hp_mf_dim: 64
:::MLPv0.5.0 ncf 1542324664.943 (NeuralCFexample.scala:187) model_hp_mlp_layer_sizes: "[256, 256, 128, 64]"
:::MLPv0.5.0 ncf 1542324670.459 (NeuralCFexample.scala:199) model_hp_loss_fn: "binary_cross_entropy"
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 1 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 2 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 3 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 4 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 5 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 6 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 7 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 8 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 9 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 10 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 11 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 12 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 13 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 14 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 15 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 16 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 17 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 18 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 19 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 20 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 21 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 22 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 23 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 24 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 25 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 26 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 27 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 28 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 1 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 2 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 3 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 4 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 5 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 6 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 7 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 8 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 9 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 10 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 11 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 12 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 13 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 14 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 15 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 16 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 17 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 18 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 19 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 20 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 21 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 22 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 23 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 24 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 25 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 26 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 27 model...
2018-11-15 15:31:10 INFO  NCFOptimizer2$:384 - Clone 28 model...
:::MLPv0.5.0 ncf 1542324670.834 (NCFOptimizer2.scala:105) train_loop
:::MLPv0.5.0 ncf 1542324670.988 (NCFDataSet.scala:38) input_hp_num_neg: 4
2018-11-15 15:31:13 INFO  NCFOptimizer2$:117 - Generate epoch 1 data: 2024 ms
2018-11-15 15:31:13 INFO  NCFOptimizer2$:120 - model thread pool size is 1
:::MLPv0.5.0 ncf 1542324673.174 (NCFOptimizer2.scala:125) train_epoch: 0
2018-11-15 15:34:25 INFO  NCFOptimizer2$:251 - [Epoch 1 99385344/99385344][Iteration 1012][Wall Clock 192.74291974s] loss is 0.12892285042575427, training cost 192.74291974s. Throughput is 515636.8085222823 record / second. 
:::MLPv0.5.0 ncf 1542324865.997 (NCFOptimizer2.scala:312) eval_start: 0
2018-11-15 15:34:25 INFO  NCFOptimizer2$:313 - [Epoch 1 99385344/99385344][Iteration 1012][Wall Clock 192.74291974s] Validate model...
2018-11-15 15:35:16 INFO  NCFOptimizer2$:358 - [Epoch 1 99385344/99385344][Iteration 1012][Wall Clock 192.74291974s] HitRatio@10 is (HitRatio@10: 74706.0, count: 138493, Average HitRatio@10: 0.5394208)
:::MLPv0.5.0 ncf 1542324916.833 (NCFOptimizer2.scala:359) eval_size: {"epoch": 0, "value": 138493000}
:::MLPv0.5.0 ncf 1542324916.833 (NCFOptimizer2.scala:361) eval_hp_num_users: 138493
:::MLPv0.5.0 ncf 1542324916.834 (NCFOptimizer2.scala:362) eval_hp_num_neg: 999
:::MLPv0.5.0 ncf 1542324916.834 (NCFOptimizer2.scala:363) eval_accuracy: {"epoch": 0, "value": 0.5394208}
2018-11-15 15:35:16 INFO  NCFOptimizer2$:368 - [Epoch 1 99385344/99385344][Iteration 1012][Wall Clock 192.74291974s] Validation time cost: 50.836037139s. Throughput is 2724307.5541337193 samples / sec
:::MLPv0.5.0 ncf 1542324916.834 (NCFOptimizer2.scala:370) eval_stop
:::MLPv0.5.0 ncf 1542324916.834 (NCFOptimizer2.scala:260) input_step_train_neg_gen
:::MLPv0.5.0 ncf 1542324916.834 (NCFDataSet.scala:38) input_hp_num_neg: 4
:::MLPv0.5.0 ncf 1542324918.519 (NCFOptimizer2.scala:263) train_epoch: 1
2018-11-15 15:35:18 INFO  NCFOptimizer2$:264 - Generate epoch 2 data: 1685 ms
2018-11-15 15:38:01 INFO  NCFOptimizer2$:251 - [Epoch 2 99385344/99385344][Iteration 2023][Wall Clock 355.485854424s] loss is 0.1126189905085734, training cost 162.742934684s. Throughput is 610689.1472307402 record / second. 
:::MLPv0.5.0 ncf 1542325081.329 (NCFOptimizer2.scala:312) eval_start: 1
2018-11-15 15:38:01 INFO  NCFOptimizer2$:313 - [Epoch 2 99385344/99385344][Iteration 2023][Wall Clock 355.485854424s] Validate model...
2018-11-15 15:38:52 INFO  NCFOptimizer2$:358 - [Epoch 2 99385344/99385344][Iteration 2023][Wall Clock 355.485854424s] HitRatio@10 is (HitRatio@10: 81699.0, count: 138493, Average HitRatio@10: 0.58991426)
:::MLPv0.5.0 ncf 1542325132.906 (NCFOptimizer2.scala:359) eval_size: {"epoch": 1, "value": 138493000}
:::MLPv0.5.0 ncf 1542325132.907 (NCFOptimizer2.scala:361) eval_hp_num_users: 138493
:::MLPv0.5.0 ncf 1542325132.907 (NCFOptimizer2.scala:362) eval_hp_num_neg: 999
:::MLPv0.5.0 ncf 1542325132.907 (NCFOptimizer2.scala:363) eval_accuracy: {"epoch": 1, "value": 0.58991426}
2018-11-15 15:38:52 INFO  NCFOptimizer2$:368 - [Epoch 2 99385344/99385344][Iteration 2023][Wall Clock 355.485854424s] Validation time cost: 51.57808801s. Throughput is 2685113.1040985635 samples / sec
:::MLPv0.5.0 ncf 1542325132.908 (NCFOptimizer2.scala:370) eval_stop
:::MLPv0.5.0 ncf 1542325132.908 (NCFOptimizer2.scala:260) input_step_train_neg_gen
:::MLPv0.5.0 ncf 1542325132.908 (NCFDataSet.scala:38) input_hp_num_neg: 4
:::MLPv0.5.0 ncf 1542325134.304 (NCFOptimizer2.scala:263) train_epoch: 2
2018-11-15 15:38:54 INFO  NCFOptimizer2$:264 - Generate epoch 3 data: 1397 ms
2018-11-15 15:41:38 INFO  NCFOptimizer2$:251 - [Epoch 3 99385344/99385344][Iteration 3034][Wall Clock 519.941343352s] loss is 0.10484243237546512, training cost 164.455488928s. Throughput is 604329.746898942 record / second. 
:::MLPv0.5.0 ncf 1542325298.823 (NCFOptimizer2.scala:312) eval_start: 2
2018-11-15 15:41:38 INFO  NCFOptimizer2$:313 - [Epoch 3 99385344/99385344][Iteration 3034][Wall Clock 519.941343352s] Validate model...
2018-11-15 15:42:30 INFO  NCFOptimizer2$:358 - [Epoch 3 99385344/99385344][Iteration 3034][Wall Clock 519.941343352s] HitRatio@10 is (HitRatio@10: 83323.0, count: 138493, Average HitRatio@10: 0.6016405)
:::MLPv0.5.0 ncf 1542325350.423 (NCFOptimizer2.scala:359) eval_size: {"epoch": 2, "value": 138493000}
:::MLPv0.5.0 ncf 1542325350.424 (NCFOptimizer2.scala:361) eval_hp_num_users: 138493
:::MLPv0.5.0 ncf 1542325350.424 (NCFOptimizer2.scala:362) eval_hp_num_neg: 999
:::MLPv0.5.0 ncf 1542325350.425 (NCFOptimizer2.scala:363) eval_accuracy: {"epoch": 2, "value": 0.6016405}
2018-11-15 15:42:30 INFO  NCFOptimizer2$:368 - [Epoch 3 99385344/99385344][Iteration 3034][Wall Clock 519.941343352s] Validation time cost: 51.601655205s. Throughput is 2683886.7755269324 samples / sec
:::MLPv0.5.0 ncf 1542325350.425 (NCFOptimizer2.scala:370) eval_stop
:::MLPv0.5.0 ncf 1542325350.425 (NCFOptimizer2.scala:260) input_step_train_neg_gen
:::MLPv0.5.0 ncf 1542325350.426 (NCFDataSet.scala:38) input_hp_num_neg: 4
:::MLPv0.5.0 ncf 1542325351.634 (NCFOptimizer2.scala:263) train_epoch: 3
2018-11-15 15:42:31 INFO  NCFOptimizer2$:264 - Generate epoch 4 data: 1209 ms
2018-11-15 15:45:17 INFO  NCFOptimizer2$:251 - [Epoch 4 99385344/99385344][Iteration 4045][Wall Clock 685.970139952s] loss is 0.10029717587998935, training cost 166.0287966s. Throughput is 598603.049803711 record / second. 
:::MLPv0.5.0 ncf 1542325517.725 (NCFOptimizer2.scala:312) eval_start: 3
2018-11-15 15:45:17 INFO  NCFOptimizer2$:313 - [Epoch 4 99385344/99385344][Iteration 4045][Wall Clock 685.970139952s] Validate model...
2018-11-15 15:46:08 INFO  NCFOptimizer2$:358 - [Epoch 4 99385344/99385344][Iteration 4045][Wall Clock 685.970139952s] HitRatio@10 is (HitRatio@10: 86266.0, count: 138493, Average HitRatio@10: 0.6228907)
:::MLPv0.5.0 ncf 1542325568.968 (NCFOptimizer2.scala:359) eval_size: {"epoch": 3, "value": 138493000}
:::MLPv0.5.0 ncf 1542325568.968 (NCFOptimizer2.scala:361) eval_hp_num_users: 138493
:::MLPv0.5.0 ncf 1542325568.970 (NCFOptimizer2.scala:362) eval_hp_num_neg: 999
:::MLPv0.5.0 ncf 1542325568.970 (NCFOptimizer2.scala:363) eval_accuracy: {"epoch": 3, "value": 0.6228907}
2018-11-15 15:46:08 INFO  NCFOptimizer2$:368 - [Epoch 4 99385344/99385344][Iteration 4045][Wall Clock 685.970139952s] Validation time cost: 51.24482367s. Throughput is 2702575.4033587836 samples / sec
:::MLPv0.5.0 ncf 1542325568.970 (NCFOptimizer2.scala:370) eval_stop
:::MLPv0.5.0 ncf 1542325568.970 (NCFOptimizer2.scala:260) input_step_train_neg_gen
:::MLPv0.5.0 ncf 1542325568.971 (NCFDataSet.scala:38) input_hp_num_neg: 4
:::MLPv0.5.0 ncf 1542325570.224 (NCFOptimizer2.scala:263) train_epoch: 4
2018-11-15 15:46:10 INFO  NCFOptimizer2$:264 - Generate epoch 5 data: 1254 ms
2018-11-15 15:48:54 INFO  NCFOptimizer2$:251 - [Epoch 5 99385344/99385344][Iteration 5056][Wall Clock 850.194513863s] loss is 0.09558987697320324, training cost 164.224373911s. Throughput is 605180.227716143 record / second. 
:::MLPv0.5.0 ncf 1542325734.504 (NCFOptimizer2.scala:312) eval_start: 4
2018-11-15 15:48:54 INFO  NCFOptimizer2$:313 - [Epoch 5 99385344/99385344][Iteration 5056][Wall Clock 850.194513863s] Validate model...
2018-11-15 15:49:45 INFO  NCFOptimizer2$:358 - [Epoch 5 99385344/99385344][Iteration 5056][Wall Clock 850.194513863s] HitRatio@10 is (HitRatio@10: 87800.0, count: 138493, Average HitRatio@10: 0.63396704)
:::MLPv0.5.0 ncf 1542325785.257 (NCFOptimizer2.scala:359) eval_size: {"epoch": 4, "value": 138493000}
:::MLPv0.5.0 ncf 1542325785.258 (NCFOptimizer2.scala:361) eval_hp_num_users: 138493
:::MLPv0.5.0 ncf 1542325785.258 (NCFOptimizer2.scala:362) eval_hp_num_neg: 999
:::MLPv0.5.0 ncf 1542325785.258 (NCFOptimizer2.scala:363) eval_accuracy: {"epoch": 4, "value": 0.63396704}
2018-11-15 15:49:45 INFO  NCFOptimizer2$:368 - [Epoch 5 99385344/99385344][Iteration 5056][Wall Clock 850.194513863s] Validation time cost: 50.753367488s. Throughput is 2728745.044015945 samples / sec
:::MLPv0.5.0 ncf 1542325785.258 (NCFOptimizer2.scala:370) eval_stop
:::MLPv0.5.0 ncf 1542325785.258 (NCFOptimizer2.scala:260) input_step_train_neg_gen
:::MLPv0.5.0 ncf 1542325785.258 (NCFDataSet.scala:38) input_hp_num_neg: 4
:::MLPv0.5.0 ncf 1542325786.659 (NCFOptimizer2.scala:263) train_epoch: 5
2018-11-15 15:49:46 INFO  NCFOptimizer2$:264 - Generate epoch 6 data: 1401 ms
2018-11-15 15:52:31 INFO  NCFOptimizer2$:251 - [Epoch 6 99385344/99385344][Iteration 6067][Wall Clock 1014.979718015s] loss is 0.09124592585223061, training cost 164.785204152s. Throughput is 603120.556311146 record / second. 
:::MLPv0.5.0 ncf 1542325951.498 (NCFOptimizer2.scala:312) eval_start: 5
2018-11-15 15:52:31 INFO  NCFOptimizer2$:313 - [Epoch 6 99385344/99385344][Iteration 6067][Wall Clock 1014.979718015s] Validate model...
2018-11-15 15:53:22 INFO  NCFOptimizer2$:358 - [Epoch 6 99385344/99385344][Iteration 6067][Wall Clock 1014.979718015s] HitRatio@10 is (HitRatio@10: 87982.0, count: 138493, Average HitRatio@10: 0.6352812)
:::MLPv0.5.0 ncf 1542326002.294 (NCFOptimizer2.scala:359) eval_size: {"epoch": 5, "value": 138493000}
:::MLPv0.5.0 ncf 1542326002.294 (NCFOptimizer2.scala:361) eval_hp_num_users: 138493
:::MLPv0.5.0 ncf 1542326002.295 (NCFOptimizer2.scala:362) eval_hp_num_neg: 999
:::MLPv0.5.0 ncf 1542326002.295 (NCFOptimizer2.scala:363) eval_accuracy: {"epoch": 5, "value": 0.6352812}
2018-11-15 15:53:22 INFO  NCFOptimizer2$:368 - [Epoch 6 99385344/99385344][Iteration 6067][Wall Clock 1014.979718015s] Validation time cost: 50.796351614s. Throughput is 2726435.9663545187 samples / sec
:::MLPv0.5.0 ncf 1542326002.295 (NCFOptimizer2.scala:370) eval_stop
:::MLPv0.5.0 ncf 1542326002.295 (NeuralCFexample.scala:507) eval_target: 0.635
:::MLPv0.5.0 ncf 1542326002.295 (NeuralCFexample.scala:509) run_stop: {"success": true}
:::MLPv0.5.0 ncf 1542326002.344 (NeuralCFexample.scala:234) run_final
Finish training in 1397 seconds
ENDING TIMING RUN AT 2018-11-15 03:53:22 PM
RESULT,recommendation,1542324600,1402,rpremsee,2018-11-15 03:30:00 PM
